<%= javascript_include_tag "/javascripts/expanding.js" %>
<div id="ShareURLDiv" style="padding:5px 5px 0px 5px;display: none;" class="contentSubContainer">
<%unless @no_popup_background == "true" %>
 <div class="popup-background">
   <a href="#" class="Closebut" style="display:none;">&nbsp;</a>
 <%end%>  
  <div id="notification" class="notificationStyle">Thank You, Article has been created.</div>
 
  <div id="article_errors" style="display:none"></div>
  <%if @article_content.new_record?%>
    <%@url_id = "new_share_url"%>
    <%@form_id = "new_share_form"%>
    <%@title_id = "txtArticleTitle"%>
    <%@current_image_id = "current_image"%>
    <%@productReviewRating = "new_product_review_rating"%>
    <%@productReviewRatingField = "new_productReviewRatingField"%>
    <%@dwnld_url = "dwnld_url"%>
    <%@article_image = "article_image"%>
    <%@current_image_size = "current_image_size"%>
    <%@img_thumb = "img_thumb"%>
    <%@txtArticleDescription =  "txtArticleDescription"%>
    <%@new_article_type ="new_article_type"%>
    <%@total_images = "total_images"%>
    <%@new_article_thumbnail = "new_article_thumbnail"%>
    <%@articles_item_id = "articles_item_id"%>
    <%@manual_image= "new_manual_image"%>
    <%@thumbnail_id = "new_thumbnail_url"%>
  <%else%>
    <%@url_id = "edit_share_url_#{@article_content.id}"%>
    <%@form_id = "edit_share_form_#{@article_content.id}"%>
    <%@productReviewRating = "edit_product_review_rating_#{@article_content.id}"%>
    <%@title_id = "edit_txtArticleTitle_#{@article_content.id}"%>
    <%@current_image_id = "edit_current_image_#{@article_content.id}"%>
    <%@productReviewRatingField = "new_productReviewRatingField_#{@article_content.id}"%>
    <%@articles_item_id = "edit_articles_item_id_#{@article_content.id}"%>
    <%@img_thumb = "edit_img_thumb_#{@article_content.id}"%>
    <%@dwnld_url = "edit_dwnld_url_#{@article_content.id}"%>
    <%@article_image= "edit_article_image_#{@article_content.id}"%>
    <%@current_image_size = "edit_current_image_size_#{@article_content.id}"%>
    <%@total_images = "edit_total_images_#{@article_content.id}"%>
    <%@new_article_thumbnail = "edit_new_article_thumbnail_#{@article_content.id}"%>
    <%@txtArticleDescription =  "edit_txtArticleDescription_#{@article_content.id}"%>
    <%@new_article_type ="edit_article_type_#{@article_content.id}"%>
    <%@manual_image= "edit_manual_image_#{@article_content.id}"%>
    <%@thumbnail_id = "edit_thumbnail_url_#{@article_content.id}"%>
  <%end%>
<%= form_for :popup, :url => new_popup_article_contents_path,:html => {:method => :post,:target=>'mypopup3',:id => 'new_popup3' } do |f| %>
  <%= hidden_field_tag "sub_type","",:id => "share_sub_1" %>
    <%= hidden_field_tag "item","",:id => "share_item_1"  %>
    <%= hidden_field_tag "content","",:id => "share_content_1" %>
    <%= hidden_field_tag "title","",:id => "share_tit_1" %>
    <%= hidden_field_tag "field1","",:id=> "share_field_1" %>
    <%=  hidden_field_tag "field2","",:id=> "share_field_2"  %>
    <%= hidden_field_tag "field3","",:id=> "share_field_3"  %>
    <%=  hidden_field_tag "field4","",:id=> "share_field_4"  %> 
    <%= hidden_field_tag "description","",:id => "share_desc_1" %>
    <%= hidden_field_tag "url" %>
 <%end%>
  <%= form_for(@article_content, :as => :article_content,:html => { :id => "#{@form_id}" }, :url => download_article_contents_path, :remote => true) do |f| %>
  <%if Rails.env == "development"%>
  <% unless params[:sub_type] %>
      <div style="float:right;margin-left:2000px;">
      <!-- <img  src="/images/newwindow.png" onclick= "open_and_redirect_url1()" title="Open in new window" style="cursor:pointer;"  /> -->
   </div>   
     <%end%>
  <%end%>   
  

    <script type="text/javascript">
 
      function open_and_redirect_url1() {
     var i =  $("#article_content_sub_type").val();
     $("#share_sub_type").val(i);
     $("#share_item").val("<%= @item.id rescue ""  %>");
     $("#share_content").val("<%= @article_content.id rescue ""  %>");
     $("#share_tit_1").val($("#article_content_title").val());
     $("#share_field_1").val($("#new_share_field1").val());
     $("#share_field_2").val($("#new_share_field2").val());
     $("#share_field_3").val($("#new_share_field3").val());
     $("#share_field_4").val($("#new_share_field4").val())
     $("#url").val("true");
     var x = $(".expanding").val();
     $("#share_desc_1").val(x);
      window.open('',"mypopup3", 'toolbars=0');
     $("#contentEditView").dialog('destroy');
   $(".ui-dialog-content").dialog('destroy')
  $('#new_popup3').submit(); 
    }
</script>
  
    <%= hidden_field_tag 'default_item_id', @item.try(:id) %>
     <%= hidden_field_tag 'submit_url','submit_url' %>
    <%= f.hidden_field :itemtype_id, :value => @item.try(:itemtype_id) %>
    <%= hidden_field_tag 'share_from_home' %>
    <% if @article_content %>
    <%= hidden_field_tag :detail,@detail%>
    <%end%>
    <%= hidden_field_tag "#{@articles_item_id}" %>
    <%= f.hidden_field :type, :id => "#{@new_article_type}" %>
    <%= f.hidden_field :thumbnail, :id => "#{@new_article_thumbnail}" %>
    <%= hidden_field_tag 'external', @external %>
    <div style="padding:5px 5px 0px 0px;clear:both;">
      <% if content_category == true %>
        <div style="float:left">
          <div class="title_header float_lft">Category :</div>
          <div class="float_lft">
            <% val = @item.blank? ? 0 : @item.itemtype_id %>
            <% ac = ArticleCategory.by_itemtype_id(val) %>
            <% unless current_user.is_admin?%>
            <% ac = ac.select{|a| a.name !="Deals"} %>
            <% end%>
            <%= f.select :sub_type, ac.map { |e|[e.name, e.name]  } , { :include_blank => true } %>
          </div>
        </div>
      <%else%>
        <%= f.hidden_field :sub_type %>
      <%end%>
      <div style="clear:both;"></div>
    </div>
       <%if @article_content.new_record? %>

      <div id="shared_message" style ="padding: 10px 10px 10px 40px;margin: 10px 15px 10px 20px;display:inline;" class="alert-info">Please share the url of the <%if params[:category] == 'Q' %> question <%else%> <%= params[:category].blank? ? "content" : params[:category].to_s.downcase.singularize %> <%end%>that you like to share with others here.</div>
      <%end%>
    <div style="padding:5px 5px 0px 0px;clear:both;">
    
      <div class="title_header float_lft" ><%= f.label :url %> :</div>
      <div class="float_lft"><%= f.text_field :url, :id => "#{@url_id}", :style => "margin-left:5px;width:400px" %></div>
      <div style="clear:both;"></div>
    </div >
    <div style="padding:5px 5px 0px 0px;clear:both;display:none;" class="<%=@dwnld_url%>">
      <div class="title_header float_lft" >Title :</div>
      <div class="float_lft"><%= f.text_field :title, :id => "#{@title_id}", :style => "margin-left:5px;width:400px" %></div>
    </div>
    
    <div class="productreview" style="clear:both;display:none" id="<%=@productReviewRating%>">
      <div class="title_header float_lft">Rating :</div>
      <div id="<%=@productReviewRatingField%>" class="thereisnosuchclass"></div>
    </div>
    <div style="padding:5px 5px 0px 0px;clear:both;display:none;" class="<%=@dwnld_url%> <%=@article_image%>">
      <div class="title_header float_lft <%=@article_image%>">Thumbnail :</div>
      
     <%unless @article_content.new_record? %>
     <div id="share_1" style="display:none;">
      <img id="<%=@img_thumb%>"  style="margin-left:5px;width:75px;height:75px; display:none;" class="float_lft" />
     </div> 
      
        <div id="share_2">
         <img src="<%= @article_content.thumbnail%>"  style="margin-left:5px;width:75px;height:75px;" class="float_lft" />
         </div>
       <%else%>
         <img id="<%=@img_thumb%>"  style="margin-left:5px;width:75px;height:75px; display:none;" class="float_lft" />
      
         <%end%>
         
      <div class="float_lft <%=@article_image%>"><input type="checkbox" id="noincludethumbnail" name="noincludethumbnail">Don't Include Thumbnail</input></div>
      <div class="float_lft"><input type="checkbox" id="<%=@manual_image%>">Add Image Url</input>
        <%=f.text_field :thumbnail, :id => "#{@thumbnail_id}", :style => "display:none;width:400px"%>
      </div>

    </div>

    <div style="padding:5px 5px 0px 5px;clear:both;display:none;" class="<%=@dwnld_url%>">
      <div class="title_header float_lft <%=@article_image%>"></div>
      <div class="float_lft <%=@article_image%>">
        <span id="<%=@current_image_size%>"></span> <br />
        <span id="<%=@current_image_id%>" class="txt_blue"><%if @article_content.new_record?%>0 <%else%> 1 <%end%></span>/ <span id="<%=@total_images%>" class="txt_blue total_img">0</span> &nbsp;
        <a id="aPrev" class="txt_blue">Prev</a>
        <a id="aNext" class="txt_blue">Next</a>
      </div>
    </div>
    <div style="padding:5px 5px 0px 5px;clear:both;display:none;" class="<%=@dwnld_url%>">
      <div class="title_header float_lft" >Description :</div>
      <div style="margin-left:80px;"> <%= f.text_area :description, :id => "#{@txtArticleDescription}",:class =>'expanding', :style => "width:400px;height:50px;" %></div>
    </div>
     <%= render "shared/expanding_text_area_style" %>
    <%if @article_content.new_record?%>
      <%@search_field_id = "new_article_product"%>
      <%@ul_list_id = "new_article_product_list"%>
    <%else%>
      <%@ul_list_id = "edit_article_product_list_#{@article_content.id}"%>
      <%@search_field_id = "edit_article_product_#{@article_content.id}"%>
    <%end%>
      <br />
       <%if @article_content.new_record?%>
          <div class="title_header float_lft" ></div>
          <div class="facebook_share" style="float:left;display:none">
            <span class="title_header">Post this in Facebook also:</span><%= check_box_tag "facebook_post" %>
           </div>
      <%end%>
    <div style="padding:5px 5px 0px 0px;clear:both;display:none;" id="shareProduct">
      <div class="title_header float_lft">Product  :</div>
      <div class="taggingdiv" style="margin-left:5px;">
        <ul id="<%=@ul_list_id%>" class="tagging"></ul>
        <div class="float_lft " style="clear:both;"><input style="margin-top:5px;width:250px" placeholder="Start Typing for suggestions.." type="text" value="" id="<%=@search_field_id%>"/></div>
        <div style="clear:both;"></div>

        <div id="search_items_by_relavance" style="font-size: 12px;margin: 5px 0px 10px 5px;"></div>
        <div style="clear:both;"></div>

      </div>
      <div style="clear:both;"></div>
    </div>
    <!--- FIELD1, FIELD2, FIELD3 FOR OTHER FIELDS-->
    <%if @article_content.new_record?%>
      <%@field1_id = "new_share_field1"%>
      <%@sharefield1 = "sharefield1"%>
      <%@sharefield1Label = "sharefield1Label"%>
      <%@field2_id = "new_share_field2"%>
      <%@sharefield2 = "sharefield2"%>
      <%@sharefield2Label = "sharefield1Label2"%>
      <%@field3_id = "new_share_field3"%>
      <%@sharefield3 = "sharefield3"%>
      <%@sharefield3Label = "sharefield1Label3"%>
      <%@field4_id = "new_share_field4"%>
      <%@sharefield4 = "sharefield4"%>
      <%@sharefield4Label = "sharefield1Label4"%>
      <%button_name = "Share this content"%>
      <%@save_instruction_value = "1"%>
    <%else%>
      <%@field1_id = "edit_share_field1_#{@article_content.id}"%>
      <%@sharefield1 = "edit_sharefield1_#{@article_content.id}"%>
      <%@sharefield1Label = "edit_sharefield1Label_#{@article_content.id}"%>
      <%@field2_id = "edit_share_field2_#{@article_content.id}"%>
      <%@sharefield2 = "edit_sharefield2"%>
      <%@sharefield2Label = "edit_sharefield1Label2_#{@article_content.id}"%>
      <%@field3_id = "edit_share_field3_#{@article_content.id}"%>
      <%@sharefield3 = "edit_sharefield3_#{@article_content.id}"%>
      <%@sharefield3Label = "edit_sharefield1Label3_#{@article_content.id}"%>
      <%@field4_id = "edit_share_field4_#{@article_content.id}"%>
      <%@sharefield4 = "edit_sharefield4_#{@article_content.id}"%>
      <%@sharefield4Label = "edit_sharefield1Label4_#{@article_content.id}"%>
      <%button_name = "Update this content"%>
       <%@save_instruction_value = "0"%>
    <%end%>
    <div style="padding:5px 5px 0px 0px;text-align:center;display:none" id="<%=@sharefield1%>">
      <div class="title_header float_lft" id="<%=@sharefield1Label%>">Start date :</div>
      <div class="float_lft">
        <%= f.text_field :field1, {:style=>"margin-left:5px;width:150px", :id => @field1_id,:class => "rating_field"}  %>
      </div>
    </div>
    <div style="padding:5px 5px 0px 0px;text-align:center;display:none" id="<%=@sharefield2%>">
      <div class="title_header float_lft" id="<%=@sharefield2Label%>">End date :</div>
      <div class="float_lft">
        <%= f.text_field :field2, {:style=>"margin-left:5px;width:150px", :id => @field2_id}  %>
      </div>
    </div>
    <div style="padding:5px 5px 0px 0px;display:none;clear:both;" id="<%=@sharefield3%>">
      <div class="title_header float_lft" id="<%=@sharefield3Label%>">Location :</div>
      <div class="float_lft">
        <%= f.text_field :field3, {:style=>"margin-left:5px;",:width=>"400px", :id => @field3_id}  %>
      </div>
      <div style="clear:both;"></div>
    </div>
 
    <div style="padding:0px 5px 0px 0px;display:none" id="<%=@sharefield4%>">
      <div class="title_header float_lft" id="<%=@sharefield4Label%>">Itune url:</div>
      <div class="float_lft">
        <%= f.text_field :field4, {:style=>"margin-left:5px;width:400px",:width=>"400px", :id => @field4_id}  %>
      </div>
      <div style="clear:both;"></div>
      

   <!--   </div>-->
    </div>
    <!-- FIELD ENDS -->
    <br />
    <br />
  <!-- <div id="deals1" style='display:none' >
    <div class="title_header float_lft">Expire Date:</div>
      <div class="float_lft">
         <%= f.text_field :field1, {:style=>"margin-left:1px;width:150px", :id => "expire_date1"}%>
    </div> 
    <div class="title_header float_lft">Discount:</div>
      <div class="float_lft">
         <%= f.text_field :field2, {:style=>"margin-left:1px;width:150px"}%>
      </div>
     <div class="title_header float_lft">Completed?:</div>
      <div class="float_lft">
         <%= f.check_box :field3%>
       </div>
    </div>
      <script>
         $('#expire_date1').datepicker();
       </script> -->
     
    <div style="padding:10px 5px 20px 5px;clear:both;display:none;" class="<%=@dwnld_url%>">
      <%= f.submit button_name, :id => "submit_article", :class => "btn_submitanswer" %>
      <% unless @external.blank? %>
        <%= link_to_function "Cancel","window.open('', '_self', '');
    window.close();", :class => "btn_submitanswer"	%>
      <% end %>
      <div style="clear:both;"></div>
    </div>    
    <input type="hidden" name = "save_instruction"  id = "share_instruction_id" value ="<%=@save_instruction_value%>"/>
    <div id="url_content_desc">	</div>
<span id="share_spinner" style="padding:0px 0px 0px 180px;display:none;">
  <%= image_tag '/images/ajax-loader.gif' %>
</span>

  <% end %>
</div>
<%unless @no_popup_background == "true" %>
</div>
<%end%>
<script type="text/javascript">
  var MIN_SIZE=[100,50];
  var first=false;
  var images_index=0;
  var images = new Array();
  var sizes = new Array();
  function validateUrl(url)
  {
    var regexp = /((ftp|http|https):\/\/)?(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/
    return regexp.test(url);
  }

 // $("form#<%#=@form_id%> #submit_article").click(function(){
  //    $("#ShareURLDivEvent div#article_errors").html("");
  //    var valid = validateArticleShareForm();
  //    if (!valid){
   //     return false;
   //   }
   // });
  $(function(){
    $('form#<%=@form_id%> #submit_article').click(function(){
 var valid = validateArticleShareForm();
      if (!valid){
        return false;
      }
      if($('#<%=@url_id%>').val() && validateUrl($('#<%=@url_id%>').val())){
      // $('form#<%#=@form_id%> #submit_article').attr("disabled", "true")
      // $('input[type="submit"]').removeAttr('disabled');

<%if @article_content.new_record?%>
          // $('form#<%#=@form_id%>').attr('action','<%#= article_contents_path %>');
          //$.post('/article_contents/create',$("#<%=@form_id%>").serialize(),"script");
           $.ajax({url: '/article_contents/create', dataType:'script', type: "post",data: $("#<%=@form_id%>").serialize(),before:$('#share_spinner').show(),success: function(data){$('#share_spinner').hide();
  
 }});
<%else%>     
          //$.post('/article_contents/update/<%=@article_content.id%>',$("#<%=@form_id%>").serialize(),"script");
           $.ajax({url: '/article_contents/update/<%=@article_content.id%>', dataType:'script', type: "post",data: $("#<%=@form_id%>").serialize(),before:$('#share_spinner').show(),success: function(data){$('#share_spinner').hide();
 
 }});
          return false;
<%end%>

        return false;
        //$('#submit_article').attr("disabled", true);
      } else {
        return false;
      }
    });
    $('div#ShareURLDiv #<%=@url_id%>').keyup(function(){
      if($('div#ShareURLDiv #<%=@url_id%>').val() && validateUrl($('div#ShareURLDiv #<%=@url_id%>').val())){
       $.ajax({url: '/article_contents/download', dataType:'script', type: "post",data: $("#<%=@form_id%>").serialize(),before:$('#share_spinner').show(),success: function(data){$('#share_spinner').hide();
 
 }});
        //$('form#<%#=@form_id%>').attr('action','<%#= download_article_contents_path  %>');
        // $('form#<%#=@form_id%>').submit();
        
       
      } else {
        $('div.<%=@dwnld_url%>').hide();
      }
    });
    $('#aPrev').live("click",function(){
      if(images  && images.length>0 && images_index>0 ){
        images_index--;
        $('#<%=@current_image_id%>').html(images_index+1);
        $("#<%=@img_thumb%>").attr("src",images[images_index]);
        $('#<%=@current_image_size%>').html(sizes[images_index]);
        $("#<%=@new_article_thumbnail%>").val(images[images_index]);
        $("#<%=@thumbnail_id%>").val(images[images_index]);

      }
    });
    $('#aNext').live("click",function(){
      if(images && images.length>0 && images_index<images.length-1 ){
        images_index++;
        $("#share_2").hide();
        $("#share_1").show();
        $('#<%=@current_image_id%>').html(images_index+1);
        $('#<%=@current_image_size%>').html(sizes[images_index]);
        $("#<%=@img_thumb%>").attr("src",images[images_index]);
        $("#<%=@new_article_thumbnail%>").val(images[images_index]);
        $("#<%=@thumbnail_id%>").val(images[images_index]);
      }
    });

<%if @article_content.new_record?%>
      settings={
        close:true, addButton: false,
        url: "/search/autocomplete_items",
        editMode: false, multiple: true,
        hidden_field: "<%=@articles_item_id%>"
      };
      $.textTagger("<%=@search_field_id%>","<%=@ul_list_id%>",settings);
  <% unless @item.blank? %>
        $.addTag("<%=@search_field_id%>","<%=@ul_list_id%>", settings,"<%= @item.name %>", "<%= @item.id %>", false);
        $.addIdToField(settings.hidden_field, "<%= @item.id %>", false)
        $("ul#<%=@ul_list_id%> li:first span a.icon_close_tagging").remove();
  <% end %>
<%else%>
      settings={
        has_parent:true,
        close:true, addButton: false,
        url: "/search/autocomplete_items",
        editMode: false, multiple: true,
        hidden_field: "#ShareURLDiv #<%=@articles_item_id%>"
      };
  <% @items.each do |item| %>
        $.addTag("#<%=@search_field_id%>","ul#<%=@ul_list_id%>", settings,"<%= item.name %>", "<%= item.id %>", true);
        $.addIdToField(settings.hidden_field, "<%= item.id %>", true)
       //$("ul#<%=@ul_list_id%> li:first span a.icon_close_tagging").remove();
   
  <%end%>
  <%unless @article_content.is_review_content?%>
        $.textTagger("#ShareURLDiv #<%=@search_field_id%>","#ShareURLDiv #<%=@ul_list_id%>",settings);
        $("#ShareURLDiv input#<%=@search_field_id%>").show();
  <%else%>
        $("#ShareURLDiv input#<%=@search_field_id%>").hide();
  <%end%>
<%end%>

<% unless @article_content.url.blank? %> 
  <%= render :file =>"article_contents/download.js" %>
<% end %>
  });

  function check_imagesize_on_load(url){
    images_index=0;
  images = new Array();
  sizes = new Array();
    var img = new Image();
    img.onload = function() {
      if(this.width >=MIN_SIZE[0] &&  this.height >=MIN_SIZE[1]){
        add_image_to_list(url,[this.width,this.height]);
      }
    }
    img.src = url;
  }
  function add_image_to_list(url,size){
 ; 
     
    images.push(url);
    sizes.push(size[0]+"*"+size[1]);
    if(images.length == 1){
      first=false;
     
      $("#<%=@img_thumb%>").attr("src",url);
      $("#<%=@new_article_thumbnail%>").val(url);
      <%if @article_content.new_record?%>
        $("#<%=@thumbnail_id%>").val(url);
      <%end%>  
      $("#<%=@img_thumb%>").show();
      $(".<%=@article_image%>").show();
      $('#<%=@current_image_size%>').html(size[0]+"*"+size[1]);
      $('#<%=@current_image_id%>').html(1);
      images_index=0;
      
    }
    <%if @article_content.new_record?%>
      $('#<%=@total_images%>').html(images.length);
    <%else%>
       $('.total_img').html(images.length);
     <%end%>
  }

  function unescapeHTML(html) {
    return $("<div />").html(html).text();
  }
  function escapeHTML(html) {
    return $("<div />").text(html).html();
  }   

  function validateArticleShareForm(){
   
    var valid = true;
<%unless @external%>
      $('#<%=@url_id%>').poshytip('destroy')
      $('#<%=@ul_list_id%>').poshytip('destroy')
      // $('#txtArticleDescription').poshytip('destroy')
      if ($("#<%=@url_id%>").val() == ""){
        $('#<%=@url_id%>').poshytip({
          className: 'tip-darkgray',
          content: 'Please enter the title.',
          showOn: 'none',
          alignTo: 'target',
          alignX: 'right',
          offsetX: 5,
          alignY: 'center'
        });
        $('#<%=@url_id%>').poshytip('show');
        valid = false

      }

      if ($("#<%=@articles_item_id%>").val() == ""){
        $('#<%=@ul_list_id%>').poshytip({
          className: 'tip-darkgray',
          content: 'Please select a product to tag with.',
          showOn: 'none',
          alignTo: 'target',
          alignX: 'right',
          offsetX: 5,
          alignY: 'center'
        });
        $('#<%=@ul_list_id%>').poshytip('show');
        valid = false
      }
      // return false
<%else%>

if ($("#article_content_sub_type").val() == ""){
        $('#article_content_sub_type').poshytip({
          className: 'tip-darkgray',
          content: 'Please select a content category.',
          showOn: 'none',
          alignTo: 'target',
          alignX: 'right',
          offsetX: 5,
          alignY: 'center'
        });
        $('#article_content_sub_type').poshytip('show');
        valid = false
      }
<%end%>
    return valid
  }
<% unless @item.blank? %>
    function showProductTag(){
      var itemId = <%= @item.id %>
      var defaultId = "textTaggers" + itemId
      $("ul#<%=@ul_list_id%> li").each(function (i) {
        var id = $(this).attr('id');
        if (id != defaultId){
          $(this).remove();
        }
      });
      $("#shareProduct").show();
      $("div#ShareURLDiv input#<%=@search_field_id%>").show();
      $("#<%=@articles_item_id%>").val(itemId);
    }

    function hideProductTag(){
      var itemId = <%= @item.id %>
      $("#shareProduct").hide();
      $("#<%=@articles_item_id%>").val(itemId);
    }
<%end%>


  function hideAllOptionalFieldsArticleSubmit(){
    $("#<%=@form_id%> #<%=@field1_id%>").val('');
    $("#<%=@form_id%> #<%=@field2_id%>").val('');
    $("#<%=@form_id%> #<%=@field3_id%>").val('');
    $("#<%=@form_id%> #<%=@field4_id%>").val('');
    $("div#ShareURLDiv #<%=@sharefield1%>").hide();
    $("div#ShareURLDiv #<%=@sharefield2%>").hide();
    $("div#ShareURLDiv #<%=@sharefield3%>").hide();
    $("div#ShareURLDiv #<%=@sharefield4%>").hide();
    $('div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>').css("width","400px");
    hideReview();
  }

  function hideReview(){
    $("div#ShareURLDiv div#<%=@productReviewRating%>").hide();
    $("#<%=@productReviewRatingField%>-score").val('')
  }
  function setDefaultFieldsArticleSubmit(category){
<%if @article_content.new_record?%>
      var saveButtonName = "Share this " + category
<%else%>
      var saveButtonName = "Update this " + category
<%end%>
    $("form#<%=@form_id%> #submit_article").val(saveButtonName)
    hideAllOptionalFieldsArticleSubmit();
    
    if (category == "<%=ArticleCategory::EVENT%>"){
     // $("#deals1").remove();
      showArticleSubmitEventOptFields();
    }
    else if(category == "<%=ArticleCategory::ACCESSORIES%>"){
      //$("#deals1").remove();
      showArticleSubmitAccessoriesOptFields();
    }
    else if (category == "<%=ArticleCategory::APPS%>"){
      // $("#deals1").remove();
      showArticleSubmitAppOptFields();
    }
    else if (category == "<%=ArticleCategory::TRAVELOGUE%>"){
       //$("#deals1").remove();
      showArticleSubmitTravelogueOptFields();
    }
    else if (category == "<%=ArticleCategory::REVIEWS%>"){
      //$("#deals1").remove();
      showReview();
    }
    else if (category == "<%=ArticleCategory::COMPARISONS%>"){
      //$("#deals1").remove();
      showComparisons();
    }

    else if (category == "<%=ArticleCategory::DEALS%>"){
     showArticleSubmitDealsOptFields()
    }
    else if (category == "<%=ArticleCategory::MILES%>"){
       //$("#deals1").remove();
      showArticleSubmitMileOptFields();
    }
  }
  function showReview()
  {

    $("div#ShareURLDiv div#<%=@productReviewRating%>").show();
    $("div#ShareURLDiv #<%=@sharefield2%>").show();
    $("div#ShareURLDiv #<%=@sharefield3%>").show();
    $("div#ShareURLDiv #<%=@sharefield4%>").show();

    $("div#ShareURLDiv #<%=@sharefield2Label%>").text("Pro:")
    $("div#ShareURLDiv #<%=@sharefield3Label%>").text("Con:")
    $("div#ShareURLDiv #<%=@sharefield4Label%>").text("Verdict:")

    <%if @content.nil?%>
    $("div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>").replaceWith("<input id='<%= @field1_id %>' name='article_content[field1]' type='text' style='margin-left:5px;width:150px'/>"); 
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>").replaceWith("<textarea id='<%=@field2_id%>' name='article_content[field2]' type='text' style='margin-left:5px;width:400px;min-height:40px;' />");
  $("div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>").replaceWith("<textarea id='<%=@field3_id%>' name='article_content[field3]' type='text' style='margin-left:5px;width:400px;min-height:40px;' />");
  $("div#ShareURLDiv form#<%=@form_id%> #<%=@field4_id%>").replaceWith("<textarea id='<%=@field4_id%>' name='article_content[field4]' type='text' style='margin-left:5px;width:400px;min-height:40px;' />");

    $("div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>").val('');
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>").val('');
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field4_id%>").val('');
  <%else%>
    $("div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>").replaceWith("<input class='rating_field' name='article_content[field1]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field1%>'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>").replaceWith("<textarea id='<%=@field2_id%>' name='article_content[field2]' type='text' style='margin-left:5px;width:400px;min-height:40px;''><%=@content.field2%></textarea>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>").replaceWith("<textarea id='<%=@field3_id%>' name='article_content[field3]' type='text' style='margin-left:5px;width:400px;min-height:40px;'><%=@content.field3%></textarea>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field4_id%>").replaceWith("<textarea id='<%=@field4_id%>' name='article_content[field4]' type='text' style='margin-left:5px;width:400px;min-height:40px;'><%=@content.field4%></textarea>");
  <%end%> 
    
  } 
 function showComparisons()
  {

    $("div#ShareURLDiv #<%=@sharefield4%>").show();
    $("div#ShareURLDiv #<%=@sharefield4Label%>").text("Verdict:")
    <%if @content.nil?%>    
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field4_id%>").replaceWith("<textarea id='<%=@field4_id%>' name='article_content[field4]' type='text' style='margin-left:5px;width:400px;min-height:70px;' />");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field4_id%>").val('');
    <%else%>
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field4_id%>").replaceWith("<textarea id='<%=@field4_id%>' name='article_content[field4]' type='text' style='margin-left:5px;width:400px;min-height:70px;'><%=@content.field4%></textarea>");
    <%end%> 
    
  } 
 
  
  function showArticleSubmitMileOptFields(){
    $("div#ShareURLDiv #<%=@sharefield1Label%>").text("City:")
    $("div#ShareURLDiv #<%=@sharefield2Label%>").text("Route:")
    $("div#ShareURLDiv #<%=@sharefield3Label%>").text("Total Distance:")
    $("div#ShareURLDiv #<%=@sharefield4Label%>").text("Time Taken:")
<%if @content.nil?%>
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>").replaceWith("<input id='<%=@field1_id%>' name='article_content[field1]' type='text' style='margin-left:5px;width:150px'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>").replaceWith("<input id='<%=@field2_id%>' name='article_content[field2]' type='text' style='margin-left:5px;width:150px'/>");

      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>").val('');
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>").val('');
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>").val('');
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field4_id%>").val('');
<%else%>
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>").replaceWith("<input id='<%=@field1_id%>' name='article_content[field1]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field1%>'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>").replaceWith("<input id='<%=@field2_id%>' name='article_content[field2]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field2%>'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>").replaceWith("<input id='<%=@field3_id%>' name='article_content[field3]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field3%>'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field4_id%>").replaceWith("<input id='<%=@field4_id%>' name='article_content[field4]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field4%>'/>");
<%end%>
    $("div#ShareURLDiv #<%=@sharefield1%>").show();
    $("div#ShareURLDiv #<%=@sharefield2%>").show();
    $("div#ShareURLDiv #<%=@sharefield3%>").show();
    $("div#ShareURLDiv #<%=@sharefield4%>").show();
  }
  
  function showArticleSubmitTravelogueOptFields(){
    $("div#ShareURLDiv #<%=@sharefield1Label%>").text("From:")
    $("div#ShareURLDiv #<%=@sharefield2Label%>").text("To:")
    $("div#ShareURLDiv #<%=@sharefield3Label%>").text("Travel Type:")
    $("div#ShareURLDiv #<%=@sharefield4Label%>").text("No of Days:")
<%if @content.nil?%>
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>").replaceWith("<input id='<%=@field1_id%>' name='article_content[field1]' type='text' style='margin-left:5px;width:150px'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>").replaceWith("<input id='<%=@field2_id%>' name='article_content[field2]' type='text' style='margin-left:5px;width:150px'/>");

      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>").val('');
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>").val('');
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>").replaceWith("<%=get_travel_types_html_list("#{@field3_id}", "article_content[field3]")%>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field4_id%>").val('');
<%else%>
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>").replaceWith("<input id='<%=@field1_id%>' name='article_content[field1]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field1%>'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>").replaceWith("<input id='<%=@field2_id%>' name='article_content[field2]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field2%>'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>").replaceWith("<%=get_travel_types_html_list("#{@field3_id}", "article_content[field3]")%>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field4_id%>").replaceWith("<input id='<%=@field3_id%>' name='article_content[field3]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field4%>'/>");
<%end%>
    $("div#ShareURLDiv #<%=@sharefield1%>").show();
    $("div#ShareURLDiv #<%=@sharefield2%>").show();
    $("div#ShareURLDiv #<%=@sharefield3%>").show();
    $("div#ShareURLDiv #<%=@sharefield4%>").show();
    $('div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>').datepicker({ altFormat: 'dd MM, yy' });

    $('div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>').css("width","150px");
  }
  
  function showArticleSubmitEventOptFields(){
    $("div#ShareURLDiv #<%=@sharefield1Label%>").text("Start Date:")
    $("div#ShareURLDiv #<%=@sharefield2Label%>").text("End Date:")
    $("div#ShareURLDiv #<%=@sharefield3Label%>").text("Location:")
<%if @content.nil?%>
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>").replaceWith("<input id='<%=@field1_id%>' name='article_content[field1]' type='text' style='margin-left:5px;width:150px'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>").replaceWith("<input id='<%=@field2_id%>' name='article_content[field2]' type='text' style='margin-left:5px;width:150px'/>");

      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>").val('');
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>").val('');
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>").val('');
<%else%>
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>").replaceWith("<input id='<%=@field1_id%>' name='article_content[field1]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field1%>'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>").replaceWith("<input id='<%=@field2_id%>' name='article_content[field2]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field2%>'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>").replaceWith("<input id='<%=@field3_id%>' name='article_content[field3]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field3%>'/>");
<%end%>
    $("div#ShareURLDiv #<%=@sharefield1%>").show();
    $("div#ShareURLDiv #<%=@sharefield2%>").show();
    $("div#ShareURLDiv #<%=@sharefield3%>").show();
    $('div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>').datepicker({altField: 'div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>',altFormat: 'dd/mm/yy' });
     $('div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>').datepicker({altField: 'div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>',altFormat: 'dd/mm/yy' });
    
  }

  function showArticleSubmitDealsOptFields(){
    $("div#ShareURLDiv #<%=@sharefield1Label%>").text("Expire Date:")
    $("div#ShareURLDiv #<%=@sharefield2Label%>").text("Discount:")
    $("div#ShareURLDiv #<%=@sharefield3Label%>").text("Completed?:")
     $("div#ShareURLDiv #<%=@sharefield4Label%>").text("Priority:")
<%if @content.nil?%>
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>").replaceWith("<input id='<%=@field1_id%>' name='article_content[field1]' type='text' style='margin-left:5px;width:150px'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>").replaceWith("<input id='<%=@field2_id%>' name='article_content[field2]' type='text' style='margin-left:5px;width:150px'/>");
       $("div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>").replaceWith("<input id='<%=@field3_id%>' name='article_content[field3]' type='checkbox' style='margin-left:5px;width:150px'/>"); 
       $("div#ShareURLDiv form#<%=@form_id%> #<%=@field4_id%>").replaceWith("<input id='<%=@field4_id%>' name='article_content[field4]' type='text' style='margin-left:5px;width:150px'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>").val('');
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>").val('');
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>").val('1');
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field4_id%>").val('2');
<%else%>
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>").replaceWith("<input id='<%=@field1_id%>' name='article_content[field1]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field1%>'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field2_id%>").replaceWith("<input id='<%=@field2_id%>' name='article_content[field2]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field2%>'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>").replaceWith("<input id='<%=@field3_id%>' name='article_content[field3]' type='checkbox' style='margin-left:5px;width:150px' checked='true'/>");
      $("div#ShareURLDiv form#<%=@form_id%> #<%=@field4_id%>").replaceWith("<input id='<%=@field4_id%>' name='article_content[field4]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field4%>'/>");
       $("div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>").val('1');
        <%if @content.field3 == '1' %> 
        $("div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>").attr('checked', true);
      <%else%>
          $("div#ShareURLDiv form#<%=@form_id%> #<%=@field3_id%>").attr('checked', false); 
       <%end%> 
<%end%>
    $("div#ShareURLDiv #<%=@sharefield1%>").show();
    $("div#ShareURLDiv #<%=@sharefield2%>").show();
    $("div#ShareURLDiv #<%=@sharefield3%>").show();
    $("div#ShareURLDiv #<%=@sharefield4%>").show();
    $('div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>').datepicker({ altField: 'div#ShareURLDiv form#<%=@form_id%> #<%=@field1_id%>',altFormat: 'dd/mm/yy' });
  }



  function showArticleSubmitAppOptFields(){
    $("div#ShareURLDiv #<%=@sharefield1Label%>").text("Sub Category:")
    $("div#ShareURLDiv #<%=@field1_id%>").replaceWith("<%=get_apps_subcategory_html_list("#{@field1_id}", "article_content[field1]")%>");
    $("div#ShareURLDiv #<%=@sharefield1%>").show();
    $("div#ShareURLDiv #<%=@sharefield2Label%>").text("Type:")
    $("div#ShareURLDiv #<%=@field2_id%>").replaceWith("<%=get_apps_type_html_list("#{@field2_id}", "article_content[field2]")%>");
<%unless @content.nil?%>
      $("div#ShareURLDiv #<%=@field1_id%>").val("<%=@content.field1%>")
      $("div#ShareURLDiv #<%=@field2_id%>").val("<%=@content.field2%>")
      $("div#ShareURLDiv #<%=@field3_id%>").replaceWith("<input id='<%=@field3_id%>' name='article_content[field3]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field3%>'/>");
      $("div#ShareURLDiv #<%=@field4_id%>").replaceWith("<input id='<%=@field4_id%>' name='article_content[field4]' type='text' style='margin-left:5px;width:150px' value='<%=@content.field4%>'/>");

<%end%>
    $("div#ShareURLDiv #<%=@sharefield2%>").show();
    $("div#ShareURLDiv #<%=@sharefield3%>").hide();
    $("div#ShareURLDiv #<%=@sharefield3Label%>").text("Android Url:")
    $("div#ShareURLDiv #<%=@sharefield4Label%>").text("Itune Url:")
    $("div#ShareURLDiv #<%=@sharefield4%>").show();
    $("div#ShareURLDiv #<%=@sharefield3%>").show();
  }

  function showArticleSubmitAccessoriesOptFields(){
    $("div#ShareURLDiv #<%=@sharefield1Label%>").text("Sub Category:")
    $("div#ShareURLDiv #<%=@field1_id%>").replaceWith("<%=get_books_accessories_subcategory_html_list("#{@field1_id}", "article_content[field1]")%>");
<%unless @content.nil?%>
      $("div#ShareURLDiv #<%=@field1_id%>").val("<%=@content.field1%>")
<%end%>
    $("div#ShareURLDiv #<%=@sharefield1%>").show();
    $("div#ShareURLDiv #<%=@sharefield2%>").hide();
    $("div#ShareURLDiv #<%=@sharefield3%>").hide();
  }

  function hideField1(){
    $("#<%=@sharefield1%>").hide();
    $("#<%=@sharefield1Label%>").text("Start Date:")
    $("#<%=@form_id%> #<%=@field1_id%>").replaceWith("<input id='<%=@field1_id%>' name='article_content[field1]' type='text' style='margin-left:5px;width:150px'/>");
    $("#<%=@form_id%> #<%=@field1_id%>").val('');

  }

  function hideField2(){
    $("#<%=@sharefield2%>").hide();
    $("#<%=@sharefield2Label%>").text("End Date:")
    $("#<%=@form_id%> #<%=@field2_id%>").replaceWith("<input id='<%=@field2_id%>' name='article_content[field2]' type='text' style='margin-left:5px;width:150px'/>");
    $("#<%=@form_id%> #<%=@field2_id%>").val('');

  }

  function hideField3(){
    $("#<%=@sharefield3%>").hide();
    $("#<%=@sharefield3Label%>").text("Location:")
    $("#<%=@form_id%> #<%=@field3_id%>").replaceWith("<input id='<%=@field3_id%>' name='article_content[field3]' type='text' style='margin-left:5px;width:150px'/>");
    $("#<%=@form_id%> #<%=@field3_id%>").val('');
  }

  function hideField4(){
    $("#<%=@sharefield4%>").hide();
    $("#<%=@sharefield4Label%>").text("Itune url:")
    $("#<%=@form_id%> #<%=@field4_id%>").replaceWith("<input id='<%=@field4_id%>' name='article_content[field4]' type='text' style='margin-left:5px;width:150px'/>");
    $("#<%=@form_id%> #<%=@field4_id%>").val('');
  }

</script>

<script type="text/javascript">
<%if @article_content.new_record?%>
    var score = 0;
<%else%>
  <%if @article_content.is_review?%>
      var score = '<%=@article_content.field1.to_f.round(1)%>';
      <%else%>
         var score = 0;
  <%end%>
<%end%>


  $(document).ready(function(){


  $('div#<%=@productReviewRatingField%>').raty({
    starOff:  'assets/star-off.png',
    starHalf   : 'assets/star-half.png',
    half       : true,
    starOn: 'assets/star-on.png',
    start: score,
    width:  '200px',
    click: function(score, evt) {
      $(".rating_field").val("" + score);
    }
  });
  	
  	//onfocus logic
  	
  	/*$("#ShareURLDiv #<%=@search_field_id%>").focus(function(){  		
  		if ($(this).autocomplete("widget").is(":visible")) {
          return;
       }  
         $(this).trigger('keydown.autocomplete');
         $(this).data("autocomplete").search($("#<%=@title_id%>").val());
       });
  
    */
    //ends
  	
  	$("#<%=@manual_image%>").click(function(event){

      if ($('#<%=@manual_image%>').is(':checked')) {$("#<%=@thumbnail_id%>").show(); } else { $("#<%=@thumbnail_id%>").hide(); }
    });
    
   <%unless @article_content.new_record?%> 
    //this is to trigger sub type change event.
  $("#article_content_sub_type").change(function() {//alert($('#article_content_sub_type :selected').text());
  var category = $('#article_content_sub_type :selected').text();
  setDefaultFieldsArticleSubmit(category);
  return false;
  });
  <%else%>

    $.ajax({
      url: '/search/search_items_by_relavance',
      dataType:'json',
      type: "get",
      data: {term: $("#txtArticleTitle").val(), search_type: $("#new_article_type").val()},
      before:$('#share_spinner').show(),
      after: $('#share_spinner').hide(),
      success: function(data){
        var container = $('#search_items_by_relavance');
        sub_contain = $("<span style='padding-right:10px;font-weight:bold;'>Suggestions:</span>")
          
        $(sub_contain).appendTo(container)
        $.each(data, function( index, value ) {
            if (value.selected_list == undefined)
            {
                sub_contain = $("<span style='display:inline-block'></span>")
                $('<input />', { type: 'checkbox', class: "relevant_product", item_name: value.value, id: 'matched'+value.id, value: value.id,name: "relevance_product[]" }).appendTo(sub_contain);
                $('<label />', { 'for': 'matched'+value.id, text: value.value + " (" + value.type + ")" ,style: "padding-right:10px;" }).appendTo(sub_contain);
                $(sub_contain).appendTo(container)
            }
            else
            {
                $.each(value.selected_list, function (inx, val) {
                    if (inx == 0)
                    {
                        var that = $("#matched"+val)
                        $("<li id='" + $(that).attr("id") + "'" + " class='taggingmain'><span><a class='txt_tagging'>" + $(that).attr("item_name") + "</a><a id= 'deleteTag' class='icon_close_tagging' href='#'></a></span></li>").appendTo($("#new_article_product_list"));
                        //debugger;
                        $.addIdToField("articles_item_id", $(that).attr("id").replace("matched",""), false)
                        $(that).parent().hide();
                    }
                    else if ($("#article_content_sub_type").val() == "Comparisons")
                    {
                        var that = $("#matched"+val)
                        $("<li id='" + $(that).attr("id") + "'" + " class='taggingmain'><span><a class='txt_tagging'>" + $(that).attr("item_name") + "</a><a id= 'deleteTag' class='icon_close_tagging' href='#'></a></span></li>").appendTo($("#new_article_product_list"));
                        //debugger;
                        $.addIdToField("articles_item_id", $(that).attr("id").replace("matched",""), false)
                        $(that).parent().hide();
                    }

                });
            }

        });




        $(".relevant_product").live("click", function(){
            $("<li id='" + $(this).attr("id") + "'" + " class='taggingmain'><span><a class='txt_tagging'>" + $(this).attr("item_name") + "</a><a id= 'deleteTag' class='icon_close_tagging' href='#'></a></span></li>").appendTo($("#new_article_product_list"));
            //debugger;
            $.addIdToField("<%=@articles_item_id%>", $(this).attr("id").replace("matched",""), false)
            $(this).parent().hide();
        })
      }
    });

   <%end%>

   $("#search_items_by_relavance input:checked").click()

      $('#deleteTag').live('click', function(){
          console.log(settings.hidden_field)
          if (settings.hidden_field != ""){
              var deleteId = $(this).closest('li').attr('id').replace("matched",'');
              $.removeIdFromField(settings.hidden_field, deleteId, false);
          }
          $(this).closest('li').remove();
          $("span #matched"+deleteId).attr("checked", false)
          $("span #matched"+deleteId).parent().show()
          if (settings.deleteFunctionName){
              data = new Object()
              data.id = deleteId;
              $.selectEvent(data, settings.deleteFunctionName)
          }
          return false;
      })
  
  });

  function hideAddImageUrl(){
    $('#<%=@manual_image%>').attr('checked', false)
    $("#<%=@thumbnail_id%>").val('');
    $("#<%=@thumbnail_id%>").hide();
  }
</script>
<script>
$("#<%= @form_id %>").submit(function(e){
       <% if !current_user %>
        $("#login-1 #click_message").html("<%= escape_javascript(render  '/shared/login_popup_message',:type => 'content')%>");
            openLoginPopup("#" + $(this).attr('id'), "submit");
            return false
          <%end%>
        })
</script>        
 <script>       
 $('div#ShareURLDiv #<%=@url_id%>').keyup(function(){
  <% if !current_user %>
   $("#login-1 #click_message").html("<%= escape_javascript(render  '/shared/login_popup_message',:type => 'content')%>");
            openLoginPopup("#" + $(this).attr('id'), "submit");
            return false
          <%end%>
        })
        
        </script>
        
        
