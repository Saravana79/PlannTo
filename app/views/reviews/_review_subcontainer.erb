<script  type="text/javascript" src="/javascripts/expanding.js"></script>
 

<div id="articleReviewSubContainer" class="contentSubContainer" style="display:none;">
<style>

span.defaultSkin table.mceLayout tbody tr.mceLast td.mceStatusbar {
    display: none !important;
}
</style>
  <div id="notification" class="notificationStyle">Thank You, Review has been created.</div>
  <%if @content.nil?%>
    <%@form_id = "new_review_content"%>
    <%@title_id = "review_content_title"%>
  <%else%>
    <%@form_id = "edit_review_content_#{@content.id}"%>
    <%@title_id ="edit_review_content_#{@content.id}"%>
  <%end%>
  <%= form_for @content || ReviewContent.new,:html => { :id => "#{@form_id}" }, :remote => true do |f| %>
  <%#= hidden_field_tag 'default_item_id', @item.try(:id) %>
    <%= f.hidden_field :itemtype_id, :value => @item.try(:itemtype_id) %>
    <%= f.hidden_field :sub_type %>
    <div id="review_new" style="display:none;"%>
    <div class="Close_dialog" style="display:none;width:43px; 
overflow:hidden;height:42px; background:url(../images/pclose_but.png) no-repeat left top;
position:relative; left:536px; text-indent:-9999px; top:-12px;" onclick="$('.ui-dialog-content').dialog('destroy')"></div>
   <%= hidden_field_tag :detail,@detail%>
 <span class="Popuptitle"><center><h1>New Review Content</h1></center></span>
 </div>
 <% unless params[:sub_type] %>
  <%if Rails.env == "development"%>
       <button onclick="open_and_redirect()" style="margin-left:350px;">Open new Window</button>
     <%end%>
   <%end%>  
     <script type="text/javascript">
  
    function open_and_redirect() {
       $("#contentEditView").dialog('destroy');
$(".ui-dialog-content").dialog('destroy')
     var i =  $("#review_content_sub_type").val();
        window.open('<%= "/article_contents/new_popup?sub_type="%>'+ i + '&&item=<%= @item.id rescue ''%>' + '&&content=<%= @content.id rescue '' %>', '', 'toolbars=0');
       
    }
</script>
  <div id="products_error" style="color:red;"></div>
     <%if @content %>
       <div class="Close_dialog" style="display:none;width:43px; 
overflow:hidden;height:42px; background:url(../images/pclose_but.png) no-repeat left top;
position:relative; left:536px; text-indent:-9999px; top:-12px;" onclick="$('.ui-dialog-content').dialog('destroy')"></div>
   <%= hidden_field_tag :detail,@detail%>
 <span class="Popuptitle"><center> <h1 id="reviewTitle">Edit <%=@content.type.underscore.humanize%></h1> </center></span>
 <%end%>
    <div style="padding:5px 5px 0px 0px;text-align:center">
      <div class="title_header float_lft">Title :</div>
      <div class="float_lft"> <%= f.text_field :title, :style=> "margin-left:5px;width:400px" %> </div>
    </div>
    
    <div class="productreview" style="clear:both;">
      <div class="title_header float_lft">Rating :</div>
      <!-- <img src="/images/rating_stars.png" style="padding-left:3px;"/> -->
      <div id="reviewRating" class="thereisnosuchclass"></div>
    </div>

    <div id="star"></div>
    <div style="padding:5px 5px 0px 0px;clear:both;" id="reviewProducts">
   
      <div class="title_header float_lft">Product  :</div>
      <div class="taggingdiv" style="margin-left:5px;">
        <ul id="review_product_item_list" class="tagging"></ul>
        <div class="float_lft " style="clear:both;display:none;" id="displayTagBox"><input style="margin-top:5px;width:250px" placeholder="Start Typing for suggestions.." type="text" value="" id="review_product_item"/></div>
        <div style="clear:both;"></div>
      </div>
      <div style="clear:both;"></div>
    </div>
    <script type="text/javascript">
      $(document).ready(function(){
  
      settings={
        close:true, addButton: false,
        url: "/search/autocomplete_items",
        editMode: false, multiple: true,
        has_parent: false,
        hidden_field: "review_content_item"
      };
      /*$.textTagger("review_product_item","review_product_item_list",settings);*/
    <% unless @item.blank? %>
        $.addTag("review_product_item","review_product_item_list", settings,"<%= @item.name %>", "<%= @item.id %>", false);
        $.addIdToField(settings.hidden_field, "<%= @item.id %>", false)
        $("ul#review_product_item_list li:first span a.icon_close_tagging").remove();
     <%else%>
      <% @items.each do |item| %>
         $.addTag("review_product_item","review_product_item_list", settings,"<%= item.name %>", "<%= item.id %>", false);
        $.addIdToField(settings.hidden_field, "<%= item.id %>", false)
        $("ul#review_product_item_list li:first span a.icon_close_tagging").remove();
      <%end%>     
    <% end %>
    

  });
  
  function validateReviewForm(){
    $('form#<%=@form_id%> input[name$="review_content[title]"]').poshytip('destroy')
    var valid = true;
    if ($('form#<%=@form_id%> input[name$="review_content[title]"]').val() == ""){
      $('form#<%=@form_id%> input[name$="review_content[title]"]').poshytip({
        className: 'tip-darkgray',
        content: 'Please enter the  title.',
        showOn: 'none',
        alignTo: 'target',
        alignX: 'right',
        offsetX: 5,
        alignY: 'center'
      });
      $('form#<%=@form_id%> input[name$="review_content[title]"]').poshytip('show');
      valid = false
    }
    return valid
  }

  <%if @content.nil?%>
    var score = 0;
  <%else%>
    var score = '<%=@content.rating%>';
  <%end%>
  $('form#<%=@form_id%> #reviewRating').raty({
    starOff:  'assets/star-off.png',
    starOn: 'assets/star-on.png',
    scoreName:    'review_content[rating]',
    half       : true,
    starHalf: 'assets/star-half.png',
    start: score,
    width:  '200px'
  });
  $(document).ready(function(){
    $('form#<%=@form_id%> #publishReview').live('click',function(e){
      // $("form#<%#=@form_id%> #publishReview").click(function(e){
      var valid = validateReviewForm();
      if (!valid){
        return false;
      }
     
      function validateReviewForm(){
      $('#review_item').poshytip('destroy')
      var valid = true;
      if ($("#review_item").val() == ""){
        $('#review_item').poshytip({
          className: 'tip-darkgray',
          content: 'Please select a product to tag with.',
          showOn: 'none',
          alignTo: 'target',
          alignX: 'right',
          offsetX: 5,
          alignY: 'center'
        });
        $('#review_item').poshytip('show');
        valid = false

      }
       return valid
    }
     });
  });
    </script>
    <div style="padding:5px 5px 0px 0px; width:550px;">
      <div class="title_header float_lft">Pros :</div>
      <%= f.text_field :pros,:style => "margin-left:5px;width:400px;",:placeholder => "" %>
    </div>
    <div style="padding:5px 5px 0px 0px; width:550px;">
      <div class="title_header float_lft">Cons :</div>
      <%= f.text_field :cons,:style => "margin-left:5px;width:400px;",:placeholder => "" %>
    </div>
    <div style="padding:5px 5px 0px 5px;">
      <div class="title_header float_lft">Description :</div>
      <div style="margin-left:80px;">
        <%= f.text_area :description, :class=>"textFilling", :style => "width:400px;height:50px;"  %>
        <br/>
      </div>
    </div>
       <%if @content.nil? || @content.new_record? %>
         <div class="title_header float_lft"></div>
          <div class="float_lft">
          <span class="title_header">Post this in Facebook also:</span>
          <%= check_box_tag "facebook_post" %>
          </div> 
     <%end%> 
     <br />
    
  <!--  <div style="padding:5px 5px 0px 80px; width:350px; ">
      <div style="float:left;">
      Would you recommend this product to your friend
      </div>
      <div style="float:left;padding-left:10px;">    
      <button class="btn_follow review_content_reco" id="reco_yes" type="button" value="true" > Yes </button>


      <button class="btn_follow review_content_reco" id="reco_no" type="button" value="false" > No </button>
    </div>
    <%= f.hidden_field :recommend_this, :value => "" %>
    </div> -->

     <input id="review_content_item" name="review_item_id" type="hidden" value="<%= @item.try(:id)%>"/>

      <%unless @item.blank? %>
         <input id="review_item" name="item_id" type="hidden" value="<%= @item.try(:id)%>"/>
       <%else%>
       <% unless @items.blank?%>
         <%ids = @items.collect(&:id).join(",") %>
          <input id="review_item" name="item_id" type="hidden" value="<%= ids %>"/>
        <%end%>
       <%end%>  
    <div style="padding:0px 5px 5px 5px; float:right; width:100%; margin-right:40px; ">
    <%= hidden_field_tag 'content_create_form_type'%>
      <%= f.submit 'Save Review',:class => 'btn_submitanswer', :id => "publishReview", 'data-disable-with'=>"Saving..."   %>
      <!-- </input> -->
    </div>
      <%= render "shared/ajax_loader" %>
  <% end %>
  <%unless @content.nil? %>
       <script type="text/javascript">
  setTimeout(function() {

g = {};

  
g.oeditor = tinyMCE.init({
        // General options
        mode : "specific_textareas",
        editor_selector : "textFilling",
       
        theme_advanced_resizing : true,
        autoresize_max_height : 300,
        autoresize_min_height :150,
        plugins : "inlinepopups,autoresize,imageupload,feature_at",
        // Theme options
        theme_advanced_buttons1 : "bold,italic,underline,separator,strikethrough,justifyleft,justifycenter,justifyright, justifyfull,bullist,numlist,undo,redo,feature_at,imageupload",
        theme_advanced_buttons2 : "",
        theme_advanced_buttons3 : "",
       
        theme_advanced_toolbar_location : "top",
     
        theme_advanced_toolbar_align : "left"
});
g.oeditor.render();
});
</script>

<%end%>
 <script>

  $("#reco_yes").click(function(){
   $("#reco_no").removeClass("reco_active");
   $("#reco_yes").addClass("reco_active");
  });
   $("#reco_no").click(function(){
    $("#reco_yes").removeClass("reco_active");
    $("#reco_no").addClass("reco_active");
  });
</script>

<script>
$("#<%= @form_id %>").submit(function(e){
       <% if !current_user %>
            openLoginPopup("#" + $(this).attr('id'), "submit");
            return false
          <%end%>
        })
</script>  
  
</div>
 
